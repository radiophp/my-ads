generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  directUrl         = env("DATABASE_DIRECT_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

model User {
  id                 String   @id @default(uuid())
  phone              String   @unique
  email              String?  @unique
  firstName          String?
  lastName           String?
  cityId             Int?
  city               City?    @relation(fields: [cityId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  profileImageUrl    String?
  role               Role     @default(USER)
  isActive           Boolean  @default(true)
  hashedRefreshToken String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([cityId])
}

model City {
  id           Int        @id
  slug         String     @unique
  name         String
  provinceId   Int
  province     Province   @relation(fields: [provinceId], references: [id], onUpdate: Cascade, onDelete: Restrict)
  allowPosting Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @default(now()) @updatedAt
  users        User[]
  districts    District[]

  @@unique([name, provinceId])
  @@index([provinceId])
}

model Province {
  id           Int      @id
  slug         String   @unique
  name         String   @unique
  allowPosting Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now()) @updatedAt
  cities       City[]
}

model District {
  id        Int      @id
  slug      String
  name      String
  cityId    Int
  city      City     @relation(fields: [cityId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@unique([cityId, slug])
  @@unique([cityId, name])
  @@index([slug])
}

model DivarCategory {
  id           String               @id @default(uuid())
  slug         String               @unique
  name         String
  displayPath  String
  path         String               @unique
  parentId     String?
  parent       DivarCategory?       @relation("DivarCategoryHierarchy", fields: [parentId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  children     DivarCategory[]      @relation("DivarCategoryHierarchy")
  depth        Int
  position     Int
  isActive     Boolean              @default(true)
  allowPosting Boolean              @default(false)
  filters      DivarCategoryFilter?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @default(now()) @updatedAt

  @@index([parentId])
  @@index([isActive])
}

model DivarCategoryFilter {
  id         String        @id @default(uuid())
  categoryId String        @unique
  category   DivarCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  payload    Json
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @default(now()) @updatedAt
}

model SubscriptionPackage {
  id              String   @id @default(uuid())
  title           String
  description     String?
  imageUrl        String?
  durationDays    Int
  freeDays        Int      @default(0)
  includedUsers   Int      @default(1)
  actualPrice     Decimal  @db.Decimal(12, 2)
  discountedPrice Decimal  @db.Decimal(12, 2)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([isActive])
}
